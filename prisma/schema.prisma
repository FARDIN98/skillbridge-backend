// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  STUDENT
  TUTOR
  ADMIN
}

enum UserStatus {
  ACTIVE
  BANNED
}

enum BookingStatus {
  CONFIRMED
  COMPLETED
  CANCELLED
}

model User {
  id        String     @id @default(uuid())
  email     String     @unique
  password  String
  name      String
  role      UserRole   @default(STUDENT)
  status    UserStatus @default(ACTIVE)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  // Relations
  tutorProfile      TutorProfile?
  studentBookings   Booking[]     @relation("StudentBookings")
  tutorBookings     Booking[]     @relation("TutorBookings")
  studentReviews    Review[]      @relation("StudentReviews")
  tutorReviews      Review[]      @relation("TutorReviews")

  @@map("users")
}

model TutorProfile {
  id           String   @id @default(uuid())
  userId       String   @unique
  bio          String?  @db.Text
  hourlyRate   Float
  subjects     String[] // Array of subject names
  experience   Int      @default(0) // Years of experience
  availability Json?    // Store availability as JSON
  rating       Float    @default(0)
  reviewCount  Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  categories Category[] @relation("TutorCategories")

  @@map("tutor_profiles")
}

model Category {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  slug        String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  tutors TutorProfile[] @relation("TutorCategories")

  @@map("categories")
}

model Booking {
  id        String        @id @default(uuid())
  studentId String
  tutorId   String
  dateTime  DateTime
  duration  Int           @default(60) // Duration in minutes
  status    BookingStatus @default(CONFIRMED)
  notes     String?       @db.Text
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  // Relations
  student User @relation("StudentBookings", fields: [studentId], references: [id], onDelete: Cascade)
  tutor   User @relation("TutorBookings", fields: [tutorId], references: [id], onDelete: Cascade)
  review  Review?

  @@index([studentId])
  @@index([tutorId])
  @@index([dateTime])
  @@map("bookings")
}

model Review {
  id        String   @id @default(uuid())
  bookingId String   @unique
  studentId String
  tutorId   String
  rating    Int // 1-5 stars
  comment   String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  student User    @relation("StudentReviews", fields: [studentId], references: [id], onDelete: Cascade)
  tutor   User    @relation("TutorReviews", fields: [tutorId], references: [id], onDelete: Cascade)

  @@index([tutorId])
  @@map("reviews")
}
